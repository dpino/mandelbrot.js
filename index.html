<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title></title>
</head>
<body>

<canvas id="myCanvas" width="600" height="480" style="border:1px solid #000000;"></canvas> 

</body>

<script type="text/javascript">
window.addEventListener('load', function() {
  let canvas = initCanvas();
  let w = new Worker('mandelbrot.js');
  w.onmessage = function(e) {
    let rgba = e.data[0];
    for (i = 0; i < length; i++) {
      canvas.img.data[i] = rgba[i];
    }
    updateCanvas(canvas);
  }
  let length = canvas.width * canvas.height * Uint32Array.BYTES_PER_ELEMENT;
  let ia = new Uint8Array(new SharedArrayBuffer(length));
  w.postMessage([ia, 0, 0, canvas.width, canvas.height]);
});

function initCanvas() {
  let canvas = document.getElementById("myCanvas");
  let ctx = canvas.getContext("2d");
  let img = ctx.getImageData(0, 0, canvas.width, canvas.height);
  return {width: canvas.width, height: canvas.height, img: img, ctx: ctx};
}

function updateCanvas(canvas) {
    canvas.ctx.putImageData(canvas.img, 0, 0);
}
</script>

</html>
